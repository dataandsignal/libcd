CC			= gcc
CFLAGS			= -c -Wall -Wextra -Wfatal-errors -Wno-unused-function
SRCDIR 			= .
DEBUGOUTPUTDIR 		= build/debug
RELEASEOUTPUTDIR	= build/release
EXAMPLE_UDP_SOURCES	= cd_example_udp.c
EXAMPLE_QUEUE_BASIC_SOURCES	= cd_example_queue_basic.c
EXAMPLE_QUEUE_SOURCES	= cd_example_queue.c
INCLUDES		= -I. -I../include
LIBS			= -lcd -pthread
_EXAMPLE_UDP_OBJECTS		= $(EXAMPLE_UDP_SOURCES:.c=.o)
EXAMPLE_UDP_DEBUGOBJECTS 	= $(patsubst %,$(DEBUGOUTPUTDIR)/%,$(_EXAMPLE_UDP_OBJECTS))
EXAMPLE_UDP_RELEASEOBJECTS 		= $(patsubst %,$(RELEASEOUTPUTDIR)/%,$(_EXAMPLE_UDP_OBJECTS))
EXAMPLE_UDP_DEBUGTARGET		= build/debug/cd-example-udp
EXAMPLE_UDP_RELEASETARGET	= build/release/cd-example-udp
_EXAMPLE_QUEUE_BASIC_OBJECTS		= $(EXAMPLE_QUEUE_BASIC_SOURCES:.c=.o)
EXAMPLE_QUEUE_BASIC_DEBUGOBJECTS 	= $(patsubst %,$(DEBUGOUTPUTDIR)/%,$(_EXAMPLE_QUEUE_BASIC_OBJECTS))
EXAMPLE_QUEUE_BASIC_RELEASEOBJECTS 		= $(patsubst %,$(RELEASEOUTPUTDIR)/%,$(_EXAMPLE_QUEUE_BASIC_OBJECTS))
EXAMPLE_QUEUE_BASIC_DEBUGTARGET		= build/debug/cd-example-queue-basic
EXAMPLE_QUEUE_BASIC_RELEASETARGET	= build/release/cd-example-queue-basic
_EXAMPLE_QUEUE_OBJECTS		= $(EXAMPLE_QUEUE_SOURCES:.c=.o)
EXAMPLE_QUEUE_DEBUGOBJECTS 	= $(patsubst %,$(DEBUGOUTPUTDIR)/%,$(_EXAMPLE_QUEUE_OBJECTS))
EXAMPLE_QUEUE_RELEASEOBJECTS 		= $(patsubst %,$(RELEASEOUTPUTDIR)/%,$(_EXAMPLE_QUEUE_OBJECTS))
EXAMPLE_QUEUE_DEBUGTARGET		= build/debug/cd-example-queue
EXAMPLE_QUEUE_RELEASETARGET	= build/release/cd-example-queue

debugprereqs:
		mkdir -p $(DEBUGOUTPUTDIR)

releaseprereqs:
		mkdir -p $(RELEASEOUTPUTDIR)

debugall:	debugprereqs $(EXAMPLE_UDP_SOURCES) $(EXAMPLE_QUEUE_BASIC_DEBUGTARGET) $(EXAMPLE_QUEUE_DEBUGTARGET) $(EXAMPLE_UDP_DEBUGTARGET)
releaseall:	releaseprereqs $(EXAMPLE_UDP_SOURCES) $(EXAMPLE_QUEUE_BASIC_RELEASETARGET) $(EXAMPLE_QUEUE_RELEASETARGET) $(EXAMPLE_UDP_RELEASETARGET)

# additional flags
# CONFIG_DEBUG_LIST	- extensive debugging of list with external debugging
# 			functions
examples-debug:		CFLAGS += -DDEBUG -g -ggdb3 -O0
examples-debug:		debugall

examples-release:	CFLAGS += -DNDEBUG
examples-release: 	releaseall

examples:		examples-release


$(EXAMPLE_UDP_DEBUGTARGET): $(EXAMPLE_UDP_DEBUGOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_UDP_DEBUGOBJECTS) $(LIBS) -o $@

$(EXAMPLE_UDP_RELEASETARGET): $(EXAMPLE_UDP_RELEASEOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_UDP_RELEASEOBJECTS) $(LIBS) -o $@

$(EXAMPLE_QUEUE_DEBUGTARGET): $(EXAMPLE_QUEUE_DEBUGOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_QUEUE_DEBUGOBJECTS) $(LIBS) -o $@

$(EXAMPLE_QUEUE_RELEASETARGET): $(EXAMPLE_QUEUE_RELEASEOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_QUEUE_RELEASEOBJECTS) $(LIBS) -o $@

$(EXAMPLE_QUEUE_BASIC_DEBUGTARGET): $(EXAMPLE_QUEUE_BASIC_DEBUGOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_QUEUE_BASIC_DEBUGOBJECTS) $(LIBS) -o $@

$(EXAMPLE_QUEUE_BASIC_RELEASETARGET): $(EXAMPLE_QUEUE_BASIC_RELEASEOBJECTS) 
	$(CC) $(LDFLAGS) $(EXAMPLE_QUEUE_BASIC_RELEASEOBJECTS) $(LIBS) -o $@

$(DEBUGOUTPUTDIR)/%.o: $(SRCDIR)/%.c
	$(CC) $(CFLAGS) $(INCLUDES) $< -o $@

$(RELEASEOUTPUTDIR)/%.o: $(SRCDIR)/%.c
	$(CC) $(CFLAGS) $(INCLUDES) $< -o $@

.c.o:
	$(CC) $(CFLAGS) $(INCLUDES) $< -o $@

all: examples-release

.DEFAULT_GOAL = examples-release

clean:
	rm -rf $(EXAMPLE_QUEUE_BASIC_DEBUGOBJECTS) $(EXAMPLE_QUEUE_BASIC_DEBUGTARGET) $(EXAMPLE_QUEUE_DEBUGOBJECTS) $(EXAMPLE_QUEUE_DEBUGTARGET) $(EXAMPLE_UDP_DEBUGOBJECTS) $(EXAMPLE_UDP_DEBUGTARGET)
	rm -rf $(EXAMPLE_QUEUE_BASIC_RELEASEOBJECTS) $(EXAMPLE_QUEUE_BASIC_RELEASETARGET) $(EXAMPLE_QUEUE_RELEASEOBJECTS) $(EXAMPLE_QUEUE_RELEASETARGET) $(EXAMPLE_UDP_RELEASEOBJECTS) $(EXAMPLE_UDP_RELEASETARGET)
